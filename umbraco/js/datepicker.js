function DatePicker(A){if(arguments.length==0){this._selectedDate=new Date;this._none=false}else{this._selectedDate=A||new Date();this._none=A==null}this._matrix=[[],[],[],[],[],[],[]];this._showNone=true;this._showToday=true;this._firstWeekDay=0;this._redWeekDay=6;this._dontChangeNone=false}DatePicker.months=["January","February","March","April","May","June","July","August","September","October","November","December"];DatePicker.days=["m","t","w","t","f","s","s"];DatePicker.prototype.onchange=function(){};DatePicker.prototype.create=function(E){if(E==null){E=document}this._document=E;this._el=E.createElement("div");this._el.className="datePicker";var H=E.createElement("div");H.className="header";this._el.appendChild(H);var C=E.createElement("table");C.className="headerTable";C.cellSpacing=0;H.appendChild(C);var A=E.createElement("tbody");C.appendChild(A);var D=E.createElement("tr");A.appendChild(D);var G=E.createElement("td");this._previousMonth=E.createElement("button");this._previousMonth.className="previousButton";this._previousMonth.setAttribute("type","button");G.appendChild(this._previousMonth);D.appendChild(G);G=E.createElement("td");G.className="labelContainer";D.appendChild(G);this._topLabel=E.createElement("a");this._topLabel.className="topLabel";this._topLabel.href="#";this._topLabel.appendChild(E.createTextNode(String.fromCharCode(160)));G.appendChild(this._topLabel);this._labelPopup=E.createElement("div");this._labelPopup.className="labelPopup";G=E.createElement("td");this._nextMonth=E.createElement("button");this._nextMonth.className="nextButton";this._nextMonth.setAttribute("type","button");G.appendChild(this._nextMonth);D.appendChild(G);H=E.createElement("div");H.className="grid";this._el.appendChild(H);this._table=H;H=E.createElement("div");H.className="footer";this._el.appendChild(H);var B=E.createElement("table");B.className="footerTable";B.cellSpacing=0;H.appendChild(B);A=E.createElement("tbody");B.appendChild(A);D=E.createElement("tr");A.appendChild(D);G=E.createElement("td");this._todayButton=E.createElement("button");this._todayButton.className="todayButton";this._todayButton.setAttribute("type","button");this._todayButton.appendChild(E.createTextNode("Today"));G.appendChild(this._todayButton);D.appendChild(G);G=E.createElement("td");G.className="filler";G.appendChild(E.createTextNode(String.fromCharCode(160)));D.appendChild(G);G=E.createElement("td");this._noneButton=E.createElement("button");this._noneButton.className="noneButton";this._noneButton.setAttribute("type","button");this._noneButton.appendChild(E.createTextNode("None"));G.appendChild(this._noneButton);D.appendChild(G);this._createTable(E);this._updateTable();this._setTopLabel();if(!this._showNone){this._noneButton.style.visibility="hidden"}if(!this._showToday){this._todayButton.style.visibility="hidden"}this._previousMonth.hideFocus=true;this._nextMonth.hideFocus=true;this._todayButton.hideFocus=true;this._noneButton.hideFocus=true;var F=this;this._previousMonth.onclick=function(){F._dontChangeNone=true;F.goToPreviousMonth();F._dontChangeNone=false};this._nextMonth.onclick=function(){F._dontChangeNone=true;F.goToNextMonth();F._dontChangeNone=false};this._todayButton.onclick=function(){F.goToToday()};this._noneButton.onclick=function(){F.setDate(null)};this._el.onselectstart=function(){return false};this._table.onclick=function(J){if(J==null){J=E.parentWindow.event}var I=J.target!=null?J.target:J.srcElement;while(I.nodeType!=1){I=I.parentNode}while(I!=null&&I.tagName&&I.tagName.toLowerCase()!="td"){I=I.parentNode}if(I==null||I.tagName==null||I.tagName.toLowerCase()!="td"){return}var K=new Date(F._selectedDate);var L=Number(I.firstChild.data);if(isNaN(L)||L<=0||L==null){return}K.setDate(L);F.setDate(K)};this._topLabel.onclick=function(I){F._showLabelPopup();return false};this._el.onkeydown=function(J){if(J==null){J=E.parentWindow.event}var I=J.keyCode!=null?J.keyCode:J.charCode;if(I<37||I>40){return true}var K=new Date(F._selectedDate).valueOf();if(I==37){K-=24*60*60*1000}else{if(I==39){K+=24*60*60*1000}else{if(I==38){K-=7*24*60*60*1000}else{if(I==40){K+=7*24*60*60*1000}}}}F.setDate(new Date(K));return false};this._el.onmousewheel=function(J){if(J==null){J=E.parentWindow.event}var L=-J.wheelDelta/120;var K=new Date(F._selectedDate);var I=K.getMonth()+L;K.setMonth(I);F._dontChangeNone=true;F.setDate(K);F._dontChangeNone=false;return false};return this._el};DatePicker.prototype.setDate=function(A){this._hideLabelPopup();if(A==null){if(!this._none){this._none=true;this._setTopLabel();this._updateTable();if(typeof this.onchange=="function"){this.onchange()}}return}if(typeof A=="string"||typeof A=="number"){A=new Date(A)}if(this._selectedDate.getDate()!=A.getDate()||this._selectedDate.getMonth()!=A.getMonth()||this._selectedDate.getFullYear()!=A.getFullYear()||this._none){if(!this._dontChangeNone){this._none=false}this._selectedDate=new Date(A);this._setTopLabel();this._updateTable();if(typeof this.onchange=="function"){this.onchange()}}if(!this._dontChangeNone){this._none=false}};DatePicker.prototype.getDate=function(){if(this._none){return null}return new Date(this._selectedDate)};DatePicker.prototype._createTable=function(I){var E,C;var L=6;var G=7;var M=0;var K=I.createElement("table");K.className="gridTable";K.cellSpacing=0;var H=I.createElement("tbody");K.appendChild(H);var D=I.createElement("tr");D.className="daysRow";var A,J;var F=String.fromCharCode(160);for(C=0;C<G;C++){A=I.createElement("td");A.appendChild(I.createTextNode(F));D.appendChild(A)}H.appendChild(D);D=I.createElement("tr");A=I.createElement("td");A.className="upperLine";A.colSpan=7;D.appendChild(A);H.appendChild(D);for(C=0;C<L;C++){D=I.createElement("tr");for(var B=0;B<G;B++){A=I.createElement("td");A.appendChild(I.createTextNode(F));D.appendChild(A)}H.appendChild(D)}E+="</table>";if(this._table!=null){this._table.appendChild(K)}};DatePicker.prototype._updateTable=function(){if(this._table==null){return}var O;var N="";var I=6;var J=7;var B=0;var C=new Array(I);this._matrix=new Array(I);for(O=0;O<I;O++){C[O]=new Array(J);this._matrix[O]=new Array(J)}var A=new Date(this._selectedDate.getFullYear(),this._selectedDate.getMonth(),1);var Q=new Date();for(O=1;O<32;O++){A.setDate(O);var K=(A.getDay()+6)%7;var M=(K-this._firstWeekDay+7)%7;if(A.getMonth()==this._selectedDate.getMonth()){var R=A.getDate()==Q.getDate()&&A.getMonth()==Q.getMonth()&&A.getFullYear()==Q.getFullYear();C[B][M]={text:"",className:""};if(this._selectedDate.getDate()==A.getDate()&&!this._none){C[B][M].className+="selected "}if(R){C[B][M].className+="today "}if((A.getDay()+6)%7==this._redWeekDay){C[B][M].className+="red"}C[B][M].text=this._matrix[B][M]=A.getDate();if(M==6){B++}}}var E=DatePicker.days;if(this._firstWeekDay!=0){E=new Array(7);for(O=0;O<7;O++){E[O]=DatePicker.days[(O+this._firstWeekDay)%7]}}var P=this._table.firstChild.tBodies[0].rows[0].cells;for(O=0;O<J;O++){P[O].firstChild.data=E[O]}var L=this._table.firstChild.tBodies[0].rows;var D;var F=String.fromCharCode(160);for(var G=0;G<I;G++){for(var H=0;H<J;H++){D=L[G+2].cells[H];if(typeof C[G][H]!="undefined"){D.className=C[G][H].className;D.firstChild.data=C[G][H].text}else{D.className="";D.firstChild.data=F}}}};DatePicker.prototype._setTopLabel=function(){var A=this._selectedDate.getFullYear()+" "+DatePicker.months[this._selectedDate.getMonth()];if(this._topLabel!=null){this._topLabel.lastChild.data=A}};DatePicker.prototype.goToNextMonth=function(){var A=new Date(this._selectedDate);A.setDate(Math.min(A.getDate(),DatePicker.getDaysPerMonth(A.getMonth()+1,A.getFullYear())));A.setMonth(A.getMonth()+1);this.setDate(A)};DatePicker.prototype.goToPreviousMonth=function(){var A=new Date(this._selectedDate);A.setDate(Math.min(A.getDate(),DatePicker.getDaysPerMonth(A.getMonth()-1,A.getFullYear())));A.setMonth(A.getMonth()-1);this.setDate(A)};DatePicker.prototype.goToToday=function(){if(this._none){this._selectedDate=new Date(this._selectedDate+10000000000)}this._none=false;this.setDate(new Date())};DatePicker.prototype.setShowToday=function(A){if(typeof A=="string"){A=!/false|0|no/i.test(A)}if(this._todayButton!=null){this._todayButton.style.visibility=A?"visible":"hidden"}this._showToday=A};DatePicker.prototype.getShowToday=function(){return this._showToday};DatePicker.prototype.setShowNone=function(A){if(typeof A=="string"){A=!/false|0|no/i.test(A)}if(this._noneButton!=null){this._noneButton.style.visibility=A?"visible":"hidden"}this._showNone=A};DatePicker.prototype.getShowNone=function(){return this._showNone};DatePicker.prototype.setFirstWeekDay=function(A){if(this._firstWeekDay!=A){this._firstWeekDay=A;this._updateTable()}};DatePicker.prototype.getFirstWeekDay=function(){return this._firstWeekDay};DatePicker.prototype.setRedWeekDay=function(A){if(this._redWeekDay!=A){this._redWeekDay=A;this._updateTable()}};DatePicker.prototype.getRedWeekDay=function(){return this._redWeekDay};DatePicker.prototype._showLabelPopup=function(){var E=function(H,G){return function(I){H._dontChangeNone=true;H._hideLabelPopup();H.setDate(G);H._dontChangeNone=false;return false}};var F=this;while(this._labelPopup.hasChildNodes()){this._labelPopup.removeChild(this._labelPopup.firstChild)}var A,C,D;for(var B=-3;B<4;B++){C=new Date(this._selectedDate);D=new Date(this._selectedDate);D.setDate(1);D.setMonth(D.getMonth()+B);C.setDate(Math.min(C.getDate(),DatePicker.getDaysPerMonth(C.getMonth()+B,D.getFullYear())));C.setMonth(C.getMonth()+B);A=this._document.createElement("a");A.href="javascript:void 0;";A.onclick=E(F,C);A.appendChild(this._document.createTextNode(C.getFullYear()+" "+DatePicker.months[C.getMonth()]));if(B==0){A.className="selected"}this._labelPopup.appendChild(A)}this._topLabel.parentNode.insertBefore(this._labelPopup,this._topLabel.parentNode.firstChild)};DatePicker.prototype._hideLabelPopup=function(){if(this._labelPopup.parentNode){this._labelPopup.parentNode.removeChild(this._labelPopup)}};DatePicker._daysPerMonth=[31,28,31,30,31,30,31,31,30,31,30,31];DatePicker.getDaysPerMonth=function(C,A){C=(C+12)%12;var B=DatePicker._daysPerMonth[C];if(C==1){B+=A%4==0&&!(A%400==0)?1:0}return B};