tinyMCE.importPluginLanguagePack("layer");var TinyMCE_LayerPlugin={getInfo:function(){return{longname:"Layer",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://tinymce.moxiecode.com/tinymce/docs/plugin_layer.html",version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion}},initInstance:function(A){if(tinyMCE.isMSIE&&!tinyMCE.isOpera){A.getDoc().execCommand("2D-Position")}},handleEvent:function(D){var C=tinyMCE.selectedInstance;var A=C.getWin(),B=C._lastStyleElm,D;if(tinyMCE.isGecko){D=this._getParentLayer(C.getFocusElement());if(D){if(!C._lastStyleElm){D.style.overflow="auto";C._lastStyleElm=D}}else{if(B){B=C._lastStyleElm;B.style.width=B.scrollWidth+"px";B.style.height=B.scrollHeight+"px";B.style.overflow="";C._lastStyleElm=null}}}return true},handleVisualAid:function(D,B,F,E){var A=E.getDoc().getElementsByTagName("div"),C;for(C=0;C<A.length;C++){if(new RegExp("absolute|relative|static","gi").test(A[C].style.position)){if(F){tinyMCE.addCSSClass(A[C],"mceVisualAid")}else{tinyMCE.removeCSSClass(A[C],"mceVisualAid")}}}},getControlHTML:function(A){switch(A){case"moveforward":return tinyMCE.getButtonHTML(A,"lang_layer_forward_desc","{$pluginurl}/images/moveforward.gif","mceMoveForward",true);case"movebackward":return tinyMCE.getButtonHTML(A,"lang_layer_backward_desc","{$pluginurl}/images/movebackward.gif","mceMoveBackward",true);case"absolute":return tinyMCE.getButtonHTML(A,"lang_layer_absolute_desc","{$pluginurl}/images/absolute.gif","mceMakeAbsolute",true);case"insertlayer":return tinyMCE.getButtonHTML(A,"lang_layer_insertlayer_desc","{$pluginurl}/images/insertlayer.gif","mceInsertLayer",true)}return""},execCommand:function(D,A,C,E,B){switch(C){case"mceInsertLayer":this._insertLayer();return true;case"mceMoveForward":this._move(1);return true;case"mceMoveBackward":this._move(-1);return true;case"mceMakeAbsolute":this._toggleAbsolute();return true}return false},handleNodeChange:function(I,C,H,D,F,E){var G=tinyMCE.getInstanceById(I);var A=this._getParentLayer(G.getFocusElement());var B=tinyMCE.getParentElement(G.getFocusElement(),"div,p,img");tinyMCE.switchClass(I+"_absolute","mceButtonDisabled");tinyMCE.switchClass(I+"_moveforward","mceButtonDisabled");tinyMCE.switchClass(I+"_movebackward","mceButtonDisabled");if(B){tinyMCE.switchClass(I+"_absolute","mceButtonNormal")}if(A&&A.style.position.toLowerCase()=="absolute"){tinyMCE.switchClass(I+"_absolute","mceButtonSelected");tinyMCE.switchClass(I+"_moveforward","mceButtonNormal");tinyMCE.switchClass(I+"_movebackward","mceButtonNormal")}},_move:function(G){var E=tinyMCE.selectedInstance,D,F=new Array();var C=this._getParentLayer(E.getFocusElement()),B=-1,H=-1;var A=tinyMCE.selectNodes(E.getBody(),function(I){return I.nodeType==1&&new RegExp("absolute|relative|static","gi").test(I.style.position)});for(D=0;D<A.length;D++){F[D]=A[D].style.zIndex?parseInt(A[D].style.zIndex):0;if(B<0&&A[D]==C){B=D}}if(G<0){for(D=0;D<F.length;D++){if(F[D]<F[B]){H=D;break}}if(H>-1){A[B].style.zIndex=F[H];A[H].style.zIndex=F[B]}else{if(F[B]>0){A[B].style.zIndex=F[B]-1}}}else{for(D=0;D<F.length;D++){if(F[D]>F[B]){H=D;break}}if(H>-1){A[B].style.zIndex=F[H];A[H].style.zIndex=F[B]}else{A[B].style.zIndex=F[B]+1}}E.repaint()},_getParentLayer:function(A){return tinyMCE.getParentNode(A,function(B){return B.nodeType==1&&new RegExp("absolute|relative|static","gi").test(B.style.position)})},_insertLayer:function(){var B=tinyMCE.selectedInstance;var E=tinyMCE.getParentElement(B.getFocusElement());var D=tinyMCE.getAbsPosition(E);var F=B.getDoc();var C=F.createElement("div");var A=B.selection.getSelectedHTML();C.style.position="absolute";C.style.left=D.absLeft+"px";C.style.top=(D.absTop>20?D.absTop:20)+"px";C.style.width="100px";C.style.height="100px";C.className="mceVisualAid";if(!A){A=tinyMCE.getLang("lang_layer_content")}C.innerHTML=A;F.body.appendChild(C)},_toggleAbsolute:function(){var B=tinyMCE.selectedInstance;var A=this._getParentLayer(B.getFocusElement());if(A==null){A=tinyMCE.getParentElement(B.getFocusElement(),"div,p,img")}if(A){if(A.style.position.toLowerCase()=="absolute"){A.style.position="";A.style.left="";A.style.top=""}else{A.style.position="absolute";if(A.style.left==""){A.style.left=20+"px"}if(A.style.top==""){A.style.top=20+"px"}if(A.style.width==""){A.style.width=A.width?(A.width+"px"):"100px"}if(A.style.height==""){A.style.height=A.height?(A.height+"px"):"100px"}tinyMCE.handleVisualAid(B.getBody(),true,B.visualAid,B)}B.repaint();tinyMCE.triggerNodeChange()}}};tinyMCE.addPlugin("layer",TinyMCE_LayerPlugin);